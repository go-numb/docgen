## ドキュメント生成ツール

このリポジトリは、指定されたディレクトリ内のファイル群を分析し、その内容に基づいて技術ドキュメントを生成するツールです。このツールは、新規参加者やプロジェクト利用者向けに、プロジェクトの全体像と効率的な理解を促進することを目的としています。

### ファイル構成

以下の図は、このプロジェクトのファイル構成を示しています。

```
├── Cargo.toml
├── README.md
└── src
    └── main.rs
        └── req
            └── gemini.rs
                └── mod.rs

```

#### ファイルの説明

**`Cargo.toml`**

* プロジェクトの依存関係とメタデータを定義します。
* `walkdir`: ディレクトリを再帰的に走査するためのライブラリ。このライブラリは、指定されたディレクトリ内のすべてのファイルを効率的に取得するために使用されます。
* `ignore`: `.gitignore` に従って無視すべきファイルを指定するためのライブラリ。このライブラリは、バージョン管理システムで無視されているファイル（例えば、一時ファイルやコンパイル済みファイル）を処理対象から除外するために使用されます。
* `reqwest`: ChatGPT API との HTTP リクエストを行うためのライブラリ。このライブラリは、ChatGPT API にファイルの内容を送信し、ドキュメント生成のリクエストを送信するために使用されます。
* `tokio`: 非同期処理のためのライブラリ。このライブラリは、複数のファイルの処理を並行して実行することで、処理時間を短縮するために使用されます。
* `clap`: コマンドライン引数の解析を行うためのライブラリ。このライブラリは、ユーザーがコマンドラインから指定したディレクトリ名、モデル名、プロンプトなどの情報を解析するために使用されます。
* `serde_json`: JSON 形式のデータのシリアライズとデシリアライズを行うためのライブラリ。このライブラリは、ChatGPT API との通信で使用する JSON データの変換を行うために使用されます。
* `serde`: シリアライズとデシリアライズの汎用ライブラリ。このライブラリは、`serde_json` ライブラリと一緒に使用され、JSON データの変換を効率的に行うための基盤を提供します。
* `chrono`: 日時操作のためのライブラリ。ドキュメントファイルの生成日時を付与するために使用されます。

**`README.md`**

* このドキュメントです。プロジェクトの概要、使用方法、設定方法などを説明します。

**`src/main.rs`**

* プログラムのエントリポイントです。
* コマンドライン引数を解析します。
* 指定されたディレクトリ内のファイル群をスキャンします。
* ファイルの内容を ChatGPT API に送信します。
* ChatGPT API の応答を処理し、ドキュメントを生成します。

**`src/req/gemini.rs`**

* ChatGPT API との通信を扱うモジュールです。
* `request`: ChatGPT API にリクエストを送信する関数。この関数は、ファイルの内容、モデル名、プロンプトなどの情報を ChatGPT API に送信するためのリクエストを作成します。
* `get_content_for_gemini`: ChatGPT API の応答からテキストコンテンツを抽出する関数。この関数は、ChatGPT API から返される JSON 形式の応答からドキュメントのテキストコンテンツを抽出します。

**`src/req/mod.rs`**

* `gemini` モジュールをエクスポートします。

### アルゴリズムと設計パターン

このツールは、以下のアルゴリズムと設計パターンを使用しています。

* **再帰的なディレクトリ走査**: `walkdir` ライブラリを使用して、指定されたディレクトリ内のファイルを再帰的に走査します。このアルゴリズムは、ディレクトリ内のすべてのファイル（サブディレクトリ内のファイルも含む）を効率的に取得するために使用されます。
* **ファイルフィルタリング**: `is_document_or_source_code` 関数を使用して、処理対象のファイルかどうかを判定します。この関数では、ファイルの拡張子に基づいて処理対象のファイルが判定されます。
* **ChatGPT API へのリクエスト**: `reqwest` ライブラリを使用して、ChatGPT API にリクエストを送信します。このプロセスでは、ファイルの内容、モデル名、プロンプトなどの情報を JSON 形式でエンコードして送信します。
* **JSON データのシリアライズとデシリアライズ**: `serde_json` ライブラリを使用して、JSON 形式のデータのシリアライズとデシリアライズを行います。このプロセスは、ChatGPT API との通信で必要となる JSON データの変換を行うために使用されます。
* **非同期処理**: `tokio` ライブラリを使用して、非同期処理を行います。この処理は、複数のファイルの処理を同時に実行することで、処理時間を短縮するために使用されます。

### 使用方法とセットアップ手順

1. **プロジェクトをビルドする**:
   ```bash
   cargo build
   ```
2. **コマンドラインで以下のコマンドを実行する**:
   ```bash
   cargo run -- [ディレクトリ名] --model [モデル名] --prompt [プロンプト]
   ```
   * `[ディレクトリ名]`: 分析対象のディレクトリの名前。デフォルト値は`.` (現在のディレクトリ) です。
   * `[モデル名]`: 使用する ChatGPT モデルの名前。デフォルト値は `gemini-1.5-flash` です。
   * `[プロンプト]`: ChatGPT API に送信するプロンプト。デフォルトのプロンプトは、ファイル構成、ファイルの主要な機能、重要な関数やクラスの説明、ファイル間の依存関係、プロジェクト全体の目的と使用方法に関するドキュメントを生成するように設定されています。

3. **ChatGPT API キーを設定する**:
   * API キーは `GOOGLE_GEMINI_API_KEY` 環境変数に設定する必要があります。

**例:**

```bash
cargo run -- dir/to/analyze --model gemini-1.5-flash --prompt "このディレクトリのファイルを分析して、技術ドキュメントを作成してください。"
```

### ベストプラクティスと拡張方法

* **コードのドキュメント化**: 関数やクラスの説明を追加し、コードの可読性を向上させる。
* **ファイルのフィルタリング機能を追加**: 特定の種類のファイルのみを処理できるようにする。例えば、拡張子で絞り込む機能を追加したり、ファイル名パターンでフィルタリングしたりすることができます。
* **複数の言語に対応**: 複数の言語で書かれたファイルに対応できるようにする。例えば、ファイルの内容を自動的に検出して適切な言語モデルを選択する機能を追加することができます。
* **出力形式の拡張**: Markdown 以外の形式（例えば、HTML や PDF）でドキュメントを出力できるようにする。
* **セキュリティの強化**: ユーザーが送信するファイルの内容を適切に処理し、セキュリティ上の問題が発生しないように注意する。

### プロジェクトの概要

このツールは、指定されたディレクトリ内のファイル群を分析し、その内容に基づいて技術ドキュメントを生成します。このドキュメントは、新規参加者やプロジェクト利用者向けに、プロジェクトの全体像と効率的な理解を促進することを目的としています。

### 各ファイルの詳細

#### `src/main.rs`

* `main` 関数: コマンドライン引数を解析し、`scan_for_files` 関数を呼び出してファイルをスキャンします。その後、ファイルの内容を ChatGPT API に送信し、応答を処理してドキュメントを生成します。
* `scan_for_files`: 指定されたディレクトリ内のファイルを走査し、ファイルの内容を文字列として返します。
* `is_document_or_source_code`: 指定されたファイルが処理対象となるドキュメントまたはソースコードかどうかを判定する関数。
* `default_prompt`: ChatGPT API に送信するプロンプトを生成する関数。

#### `src/req/gemini.rs`

* `request`: ChatGPT API にリクエストを送信する関数。
* `get_content_for_gemini`: ChatGPT API の応答からテキストコンテンツを抽出する関数。

### その他

* このツールは、ChatGPT API を使用するため、API キーが必要です。
* ファイルの送信前に、ユーザーに送信の許可を問い合わせます。
* ChatGPT API の応答は、JSON 形式で返されます。

### 改良点

* **パフォーマンスの改善**: 複数のファイルの処理に時間がかかる場合があるため、パフォーマンスの改善が必要です。例えば、並行処理の効率を向上させたり、ファイルの読み込みや書き込みの処理を最適化したりすることができます。
* **ChatGPT API の制限**: ChatGPT API の使用に制限があるため、無料版では利用回数に制限があります。有料版への移行を検討したり、他の API を使用したりする必要が生じる可能性があります。
* **コードの理解度**: より詳細なドキュメントとコードのコメントを追加することで、コードの理解度を高めることができます。
* **拡張性の向上**: 将来的に新しい機能を追加したり、他の API と連携したりできるように、コードを拡張可能な設計にすることが重要です。

### 新規参加者や利用者向けの追加指示

* このツールは、ChatGPT API との通信を行うため、インターネット接続が必要です。
* API キーは、Google Cloud Platform のアカウントで作成する必要があります。
* API キーは、環境変数 `GOOGLE_GEMINI_API_KEY` に設定する必要があります。
* プロンプトには、日本語で入力することを推奨します。
* ファイルの送信前に、ユーザーに送信の許可を求めるように実装されています。
* 出力されるドキュメントは、Markdown 形式で出力されます。

### まとめ

このドキュメントは、プロジェクトの理解を深めるために役立つ情報と、今後の開発のためのヒントを提供することを目的としています。

**このツールは、開発者や技術者向けに、コードベースから技術ドキュメントを自動生成することで、プロジェクトの理解を深め、効率的な開発を促進することを目指しています。**